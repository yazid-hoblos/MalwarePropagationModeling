---
title: "Part V"
author: "Yazid Hoblos"
date: '2023-01-12'
output: html_document
---
```{r}
library(GA)
```


```{r}

f <- function(x)  abs(x)+cos(x)
plot(f,-20,20)
min <- -20; max <- +20
curve(f, min, max)
```

```{r}
fitness <- function(x) -f(x)
GA <- ga(type = "real-valued", fitness = fitness, min = min, max = max,maxiter=150) 
```


```{r}
summary(GA)
plot(GA)
```

```{r}
monitor <- function(obj) 
{ 
  curve(f, min, max, main = paste("iteration =", obj@iter), font.main = 1)
  points(obj@population, -obj@fitness, pch = 20, col = 2)
  rug(obj@population, col = 2)
  Sys.sleep(0.2)
}
GA <- ga(type = "real-valued", fitness, min = min, max = max, monitor = monitor)
```

```{r}
sort = read.csv('updated_mutated_df.csv')
```


```{r}
sort[348922:(nrow(sort)),] =sort[348922:(nrow(sort)),] %>% arrange(substr(sort$timeStamp[348922:(nrow(sort))],15,16))

View(sort)
p=317251
for (i in 317251:nrow(sort)){
  if (substr(sort$timeStamp[i],15,16) != substr(sort$timeStamp[i-1],15,16) | (substr(sort$timeStamp[i],1,2) != substr(sort$timeStamp[i-1],1,2)) | substr(sort$timeStamp[i],12,13) != substr(sort$timeStamp[i-1],12,13)){
    sort[p:(i-1),] =sort[p:(i-1),] %>% arrange(substr(sort$timeStamp[p:(i-1)],18,19))
    p=i
  }
}
```

```{r}
write.csv(sort, "updated_mutated_df.csv", row.names=FALSE)
```

```{r}
data = read.csv('updated_mutated_df.csv')
data$flow_duration = data$flow_duration/1000
count=0
for (i in 1:nrow(data)){
  if(data$flow_duration[i]>500){
    count=count+1
  }
}
count
count/nrow(data)
```


```{r}
library(statnet)
data(florentine)
f = flomarriage
library(EpiModel)

mycontrol <- control.net("SIS", nsteps = 10, nsims = 1,	nwstats.formula = ~edges, verbose = TRUE)

myparam <-param.net(inf.prob = 0.5, 
                    rec.rate = 0,act.rate=0)
myfit <- netest(f,
                formation=~edges,
                target.stats=c(16),
                coef.diss = dissolution_coefs(~offset(edges),10))
myfit
myinit <- init.net(i.num = 4)
mySIS2 <- netsim(myfit, param = myparam, control = mycontrol,
                init = myinit)
View(as.data.frame(mySIS2))
```
```{r}
data(windsurferPanels)
  View(as.data.frame(beach[[1]]))
beach[-25]
beach[[1]]
get.vertex.attribute(beach[[1]],'vertex.names')
b = list(beach[[1]],beach[[2]],beach[[3]])
```


```{r}
length(unique(c(get.vertex.attribute(b[[1]],'vertex.names'),get.vertex.attribute(b[[2]],'vertex.names'), get.vertex.attribute(b[[3]],'vertex.names'))))
s=networkDynamic (network.list=b,vertex.pid='vertex.names')
```
```{r}
uu=as.data.frame(unique(c(data$source,data$target)))
nrow(uu)
for (i in 1:nrow(uu)){
  if(uu[i,]=="202.77.129.150 80"){
    print(i)
    break
  }
}
```
```{r}
df=read.csv('whole_dataset.csv')
for (i in 1:nrow(df)){
  if(df$Source.IP[i]=='172.217.12.206' && df$Destination.IP[i]=='10.42.0.42'){
    print(i)
  }
}
```

```{r}
View(df)
```


```{r}
formation <- ~edges

myfit <- netest(net,
                formation=formation,
                target.stats=c(214487),
                coef.diss = dissolution_coefs(~offset(edges), mean(data$flow_duration)))

mydx <- netdx(myfit, nsims=10, nsteps=100)
mydx
get_nwstats(mydx)
plot(mydx)

## Conduct disease sim

mycontrol <- control.net("SIS", nsteps = 71036, nsims = 1,	nwstats.formula = ~edges, verbose = TRUE)
myinit <- init.net(i.num = 10)
myparam <-param.net(inf.prob = 0.5, 
                    act.rate = 0.6,
                    rec.rate = 0.05)


mySIS <- netsim(myfit, param = myparam, control = mycontrol,
                init = 4)
plot(mySIS)
```

```{r}
mycontrol <- control.icm("SIS", nsteps = 1000, verbose = TRUE)
myinit <- init.icm(i.num = 4,s.num=10000)
myparam <-param.icm(inf.prob = 0.9, 
                    rec.rate = 0.16,act.rate=1)


mySIS <- icm(myparam, myinit,mycontrol)
mySIS
plot(mySIS)

plot(mySIS, y = "s.num", popfrac = TRUE, col = "Greys")
View(as.data.frame(mySIS))
```


```{r}
v=c()
for (i in 1:71036){
  name=paste('nodes_state',i,'.csv')
  d=read.csv(name)
  c=0
  for (ii in d$state){
    if(ii=='I'){
      c=c+1
    }
  }
  v=c(v,c)
}
helper <- function(x1,x2) {
mycontrol <- control.dcm("SIS", nsteps = 71036)
myinit <- init.dcm(i.num = 4,s.num=104000)
myparam <-param.dcm(inf.prob = x1, 
                    rec.rate = x2,act.rate=1)


mySIS <- dcm(myparam, myinit,mycontrol)
d=as.data.frame(mySIS)
return (5)
}

GA <- ga(type = "real-valued", 
   fitness = function(x)  helper(x[1],x[5]),
   popSize = 100, 
   pcrossover = 0.85, 
   pmutation = 0.1, 
   elitism = 0.1,
   maxiter=500,lower=c(0,0),upper=c(10,10)
   ) 
```

